<!DOCTYPE html>
<html lang="zxx" class="no-js">
   <meta charset="utf-8">
	<head>
		<!-- Mobile Specific Meta -->
		<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
		<!-- Favicon-->
		<link rel="shortcut icon" href="img/fav.png">
		<!-- Author Meta -->
		<meta name="author" content="codepixer">
		<!-- Meta Description -->
		<meta name="description" content="">
		<!-- Meta Keyword -->
		<meta name="keywords" content="">
		<!-- meta character set -->
		<meta charset="UTF-8">
		<!-- Site Title -->
		<title>Iraq and Syria wars</title>

		<link href="https://fonts.googleapis.com/css?family=Poppins:100,200,400,300,500,600,700" rel="stylesheet"> 
			<!--
			CSS
			============================================= -->
			<link rel="stylesheet" href="css/linearicons.css">
			<link rel="stylesheet" href="css/font-awesome.min.css">
			<link rel="stylesheet" href="css/bootstrap.css">
			<link rel="stylesheet" href="css/magnific-popup.css">
			<link rel="stylesheet" href="css/nice-select.css">					
			<link rel="stylesheet" href="css/animate.min.css">
			<link rel="stylesheet" href="css/owl.carousel.css">
			<link rel="stylesheet" href="css/main.css">
		
		
 
  <meta charset="utf-8">
  <script src="https://d3js.org/d3.v4.min.js"></script>
  <style>
    div.tooltip {	
    position: absolute;			
    text-align: center;	
    color: black;
    font-size: 18px;
    padding: 10px;				
    font: 12px sans-serif;		
    border: 0px;		
    border-radius: 8px;			
    pointer-events: none;}
    
   div.titre1553 {	
    position: relative;			
    text-align: center;	
    color: black;
    font-size: 19px;
    padding: 5px;				
    font: 19px Cursive;		
    border: 0px;		
    border-radius: 8px;			
    pointer-events: none;
    background-color:rgba(76, 175, 80, 0.3);
    left:0px;
    top:0px;}
   
	
   div.div2svg{	
    position: relative;    	
    color: black;
    font-size: 10px;
    padding: 5px;				
    font: 10px Cursive;		
    border: 0px;		
    border-radius: 8px;			
    pointer-events: none;
    left:0px;
    top:0px;}
   body { margin:0;top:0;right:0;bottom:0;left:0; }
  </style>
</head>

<body >

			  <header id="header" id="home">
			    <div class="container">
			    	<div class="row align-items-center justify-content-between d-flex">
				      <div id="logo">
				        <a href="index.html"><img src="img/Logo_Ã‰cole_centrale_de_Lyon.svg.png" alt="" title="" width="250px" height="40px" /></a>
				      </div>
				      <nav id="nav-menu-container">
				        <ul class="nav-menu">
				          <li class="menu-active"><a href="index.html">Home</a></li>				          
				          <li><a href="Syrian_map.html">Cartography of syrian deaths</a></li>
				          <li><a href="FinalSyrie.html">Evolution of death in Syria</a></li>
				          <li><a href="FinalIrak.html">Evolution of death in Iraq</a></li>
				          <li><a href="refugies.html"> Refugees of Syria and Iraq in the world </a></li>
				          				          
				        </ul>
				      </nav><!-- #nav-menu-container -->		    		
			    	</div>
			    </div>
			  </header>
<div style="height:150px;position:relative;over-flow:auto"></div>
 <div style="height:100px;position:relative;over-flow:auto">
  <input type="radio" id="sujet1" name="sujet" value="dem" checked>
<label for="dem">Demography</label><br>
<input type="radio" id="sujet2" name="sujet" value="dep">
<label for="dep">Departures</label><br>
<input type="radio" id="sujet3" name="sujet" value="sub">
<label for="sub">Subbmissions</label> 
</div>
 <!-- Create a div where the graph will take place -->


<script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.1/jquery.min.js"></script>
<script>

// set the dimensions and margins of the graph
var margin = {top: 10, right: 10, bottom: 10, left: 10},
  width = 900 - margin.left - margin.right,
  height = 470 - margin.top - margin.bottom;

var divtitle = d3.select("body").append("div")	
       .attr("class", "titre1553");
// Add title
divtitle.html("Demography of refugees in the world");


var divtreemap = d3.select("body").append("div")	
       .attr("id", "my_dataviz");
// append the svg object to the body of the page
var svg = d3.select("#my_dataviz")
.append("svg")
  .attr("width", width + margin.left + margin.right)
  .attr("height", height + margin.top + margin.bottom)
.append("g")
  .attr("transform",
        "translate(" + margin.left + "," + margin.top + ")");


var valueSubjectname;
const America=["USA","URY","MEX","CAN","BRA","ARG","ATG","ABW","BHS","BLZ","BOL","VGB","CYM","CHL","COL","CRI","CUB","CUW","DOM","ECU","SLV","GRD","GTM","GUY","HTI","HND","JAM","MEX","NIC","PAN","PER","KNA","LCA","SUR","TTO","TCA","VEN"];
const Europe =["ALB","AUT","BLR","BEL","BGR","HRV","CYP","CZE","DNK","EST","FIN","FRA","DEU","HUN","ISL","IRL","ITA","LVA","LIE","LTU","LUX","MLT","MCO","NLD","NOR","PRY","POL","PRT","ROU","SVK","SVN","ESP","SWE","CHE","GBR","ARM","AZE","BIH","GEO","MKD","MDA","RUS","SRB","TUR","UKR"];
const Africa =["DZA","LBY","MRT","MAR","TUN"];
const Asia =["KOR","JPN","IRQ","SYR","AFG","BGD","KHM","CHN","HKG","MAC","FJI","IND","IDN","IRN","KAZ","KGZ","MYS","FSM","MNG","MMR","NRU","NPL","PAK","PLW","PNG","PHL","WSM","SGP","SLB","LKA","TJK","THA","TLS","TKM","UZB","VUT","VNM","BHR","EGY","ISR","JOR","KWT","LBN","OMN","QAT","SAU","PSE","ARE","YEM"];
var Australia=["NZL","AUS"];

var div = d3.select("body").append("div")	
       .attr("class", "tooltip")				
       .style("opacity", 0);
  
var color_on_click;

var original_x_befor_click, original_y_befor_click, original_width_befor_click, original_height_befor_click, continent_onclick;

draw_all("https://raw.githubusercontent.com/IMrabet/Syria_Iraq_Stats/master/data_Iraq_Syria_refugees/RSQDemographics_ALL.csv","Grand_Total",true);

$('input:radio').on('change', function(e){
  var name = e.currentTarget.name,
 valueSubjectname = e.currentTarget.value;
 if(valueSubjectname=="dem"){
	divtitle.html("Demography of refugees in the world")
	d3.selectAll("path").remove();
	d3.selectAll("circle").remove();
	d3.select("#my_dataviz2Ev").remove();
	draw_all("https://raw.githubusercontent.com/IMrabet/Syria_Iraq_Stats/master/data_Iraq_Syria_refugees/RSQDemographics_ALL.csv","Grand_Total",true,valueSubjectname);

	}
 else if(valueSubjectname=="dep"){
	divtitle.html("Departures of refugees to all countries")
	d3.selectAll("path").remove();
	d3.selectAll("circle").remove();
	d3.select("#my_dataviz2Ev").remove();
	draw_all("https://raw.githubusercontent.com/IMrabet/Syria_Iraq_Stats/master/data_Iraq_Syria_refugees/RSQDepartures_Americas.csv","Total_departures_persons",false,valueSubjectname);
		}
 else{
	divtitle.html("subbmissions of refugees in all countries")
	d3.selectAll("path").remove();
	d3.selectAll("circle").remove();
	d3.select("#my_dataviz2Ev").remove();
	draw_all("https://raw.githubusercontent.com/IMrabet/Syria_Iraq_Stats/master/data_Iraq_Syria_refugees/RSQSubmissions_Americas.csv","Total_submissons_persons",false,valueSubjectname); 
	};
});

			
	
function draw_all(dataLink,champ,active_onClick,valueSubjectname){
// read json data
d3.csv(dataLink, function(data_csv) {
   
var nested_data = d3.nest()
	.key(function(d) { return d.Country_of_Resettlement_ISO; })
	.key(function(d) { return d.Year; })
	.entries(data_csv);
 //console.log(nested_data);

var parseDate = d3.timeParse("%Y");
     data_csv.forEach(function(d){      
       		d.Year = parseDate(d.Year);        
           })  

var nestedJSON = '{"name":"root","children":[{"continent":"Europe","children":';

var filtred_data_by_europe = nested_data.filter(function(d){  				
  				return Europe.indexOf(d.key)!=-1;  				
});
nestedJSON += JSON.stringify(filtred_data_by_europe)+'},';

nestedJSON += '{"continent":"Amerique","children":';
var filtred_data_by_America = nested_data.filter(function(d){  				
  				return America.indexOf(d.key)!=-1;  				
});
nestedJSON += JSON.stringify(filtred_data_by_America)+'},'; 

nestedJSON += '{"continent":"Asie","children":';
var filtred_data_by_Asia = nested_data.filter(function(d){  				
  				return Asia.indexOf(d.key)!=-1;  				
});
nestedJSON += JSON.stringify(filtred_data_by_Asia)+'},';
  
nestedJSON += '{"continent":"Afrique","children":';
var filtred_data_by_Afrique = nested_data.filter(function(d){  				
  				return Africa.indexOf(d.key)!=-1;  				
});
nestedJSON += JSON.stringify(filtred_data_by_Afrique)+'},';

nestedJSON += '{"continent":"Australie","children":';
var filtred_data_by_Australia = nested_data.filter(function(d){  				
  				return Australia.indexOf(d.key)!=-1;  				
});
nestedJSON += JSON.stringify(filtred_data_by_Australia)+'}]}';

var data = JSON.parse(nestedJSON);
  
  // Give the data to this cluster layout:
  var root = d3.hierarchy(data).sum(function(d){
    var total_country =0;
    if(d.values){                                            
    d.values.forEach(function(v){
      v.values.forEach(function(e){
        total_country+=parseInt(e[champ]);})
    });}
    return total_country}); // Here the size of each leave is given in the 'value' field in input data

//console.log(data);
//console.log(root);
//console.log(root.leaves());

  // Then d3.treemap computes the position of each element of the hierarchy
  d3.treemap()
    .size([width, height])
    .paddingTop(28)
    .paddingRight(7)
    .paddingInner(3)      // Padding between each rectangle
    //.paddingOuter(6)
    //.padding(20)
    (root)

  // prepare a color scale
  var color = d3.scaleOrdinal()
    .domain(["Europe", "Amerique", "Asie","Australie","Afrique"])
    .range([ "#8f91fe", "#ff7775", "#13c600","#d9dc0e", "#e75fce"]);

   // use this information to add rectangles:
   if(active_onClick==false){
   d3.selectAll("rect").transition().duration(1000).attr("wdith",0).attr("height",0);
   setTimeout(function(){
    d3.selectAll("rect").remove();
    var rects = svg.selectAll("rect")	
    .data(root.leaves())
    .enter()  	
    .append("rect")
      .attr("id",function(d){return d.data.key;})
      .attr('x', function (d) { return d.x0; })
      .attr('y', function (d) { return d.y0; })
      .attr('width', 0)
      .attr('height', 0)
      .style("stroke", "black")	  
      .style("fill", function(d){
    			return color(d.parent.data.continent);} )
      .style("opacity", 1)
      .on("mouseover", function(d){div.transition()		
                  .duration(500)		
                  .style("opacity", .8)
              		.style("background","white");              
              div.html("Continent : "+d.parent.data.continent+ "<br/>country : "+d.data.values[0].values[0].Country_of_Resettlement+" ("+d.data.key +")<br/> click for more details")	
                  .style("left", (d3.event.pageX) + "px")		
                  .style("top", (d3.event.pageY - 28) + "px");})					
      .on("mouseout", function(){div.style("opacity", 0);})
      .on("click",function(d){
	  var listattrubute =[champ]
	  //console.log(valueSubjectname);	  
if(valueSubjectname=="dep"){
    		divtitle.html("Departures of refugees to "+d.data.values[0].values[0].Country_of_Resettlement+"("+d.data.values[0].values[0].Country_of_Resettlement_ISO+")");
		}else{
    		divtitle.html("Subbmissions of refugees in "+d.data.values[0].values[0].Country_of_Resettlement+"("+d.data.values[0].values[0].Country_of_Resettlement_ISO+")");
		}
	  display_courbe(data_csv,d.data.values[0].values[0].Country_of_Resettlement_ISO,listattrubute);
	  });
	  rects.transition()  // Gives the fly out from the center effect
          .delay(function (d, i){
              return i * 10;  // Gives a slight delay with 100 ms spacing
          })
          .duration(800)         
          .attr('width', function (d) {return d.x1 - d.x0; })
      .attr('height', function (d) {return d.y1 - d.y0; })
	  write_labels(root);},1000)
	  
   }
   else{
   d3.selectAll("rect").transition().duration(1000).attr("wdith",0).attr("height",0);
   var coords =[];
   var i =0;
   setTimeout(function(){d3.selectAll("rect").remove();
    var rects = svg.selectAll("rect")
    .data(root.leaves())
    .enter()  	
    .append("rect")
      .attr("id",function(d){return d.data.key;})
      .attr('x', function (d) { return d.x0; })
      .attr('y', function (d) { return d.y0; })
      .attr('width', 0)
      .attr('height', 0)
      .style("stroke", "black")	  
      .style("fill", function(d){
    			return color(d.parent.data.continent);} )
      .style("opacity", 1)
      .on("mouseover", function(d){div.transition()		
                  .duration(500)		
                  .style("opacity", .8)
              		.style("background","white");              
              div.html("Continent : "+d.parent.data.continent+ "<br/>country : "+d.data.values[0].values[0].Country_of_Resettlement+" ("+d.data.key +")<br/> click for more details")	
                  .style("left", (d3.event.pageX) + "px")		
                  .style("top", (d3.event.pageY - 28) + "px");})					
      .on("mouseout", function(){div.style("opacity", 0);})
      .on("click",function(d){	if(active_onClick){
        div.style("opacity", 0);
        continent_onclick = d.data.key;
        original_x_befor_click = d.x0 ;
        original_y_befor_click = d.y0;
        original_width_befor_click = d.x1 - d.x0 ;
        original_height_befor_click= d.y1 - d.y0;
        color_on_click = color(d.parent.data.continent);
        
		
        d3.selectAll("rect").filter(function(e){
            return d==e
              }).transition()		
                .duration(1000)
            .attr('x', 0)
          .attr('y', 30)
          .attr('width', width)
          .attr('height', height)

        d3.selectAll("rect").filter(function(e){
                return d!=e
              }).transition()		
                .duration(1000).style("opacity", 0);
    
        d3.selectAll("text").remove();
   			d3.selectAll("titles").remove();
    		d3.selectAll("vals").remove();
                
    		divtitle.html("Demography of refugees in "+d.data.values[0].values[0].Country_of_Resettlement+" ("+d.data.key +")");
		
    setTimeout(function(){draw_by_gender(dataLink,d.data.values[0].values[0].Country_of_Resettlement+" ("+d.data.key +")",d.data, d.data.key, color_on_click,original_x_befor_click,original_y_befor_click,original_width_befor_click,original_height_befor_click,data_csv,d.data.key)},1000);
      }});
	  
	  rects.transition()  // Gives the fly out from the center effect
          .delay(function (d, i){
              return i * 10;  // Gives a slight delay with 100 ms spacing
          })
          .duration(800)         
          .attr('width', function (d) {return d.x1 - d.x0; })
      .attr('height', function (d) {return d.y1 - d.y0; })
	  
	  write_labels(root);
	},1000);}
	
	function write_labels(data){
	d3.selectAll("text").remove();
   			d3.selectAll("titles").remove();
    		d3.selectAll("vals").remove();
  // and to add the text labels
  svg
    .selectAll("text")
    .data(data.leaves().filter(function(d){return d.value>=230;}))
    .enter()
    .append("text")
      .attr("x", function(d){ return d.x0+5})    // +10 to adjust position (more right)
      .attr("y", function(d){ return d.y0+10})    // +20 to adjust position (lower)
      .text(function(d){ return d.data.key })
      .attr("font-size", "10px")
      .attr("fill", "white")

  // and to add the text labels
  svg
    .selectAll("vals")
    .data(data.leaves().filter(function(d){return d.value>=500;}))
    .enter()
    .append("text")
      .attr("x", function(d){ return d.x0+5})    // +10 to adjust position (more right)
      .attr("y", function(d){ return d.y0+20})    // +20 to adjust position (lower)
      .text(function(d){ return d.value })
      .attr("font-size", "11px")
      .attr("fill", "white")

  // Add title for the 3 groups
  svg
    .selectAll("titles")
    .data(data.descendants().filter(function(d){return d.depth==1})
              .filter(function(d){return d.value>0;}))
    .enter()
    .append("text")
      .attr("x", function(d){ return d.x0})
      .attr("y", function(d){ return d.y0+21})
      .text(function(d){ return d.data.continent + ": "+d.value; })
      .attr("font-size", "19px")
      .attr("fill",  function(d){return color(d.data.continent)} )
	  } 
  });
  }


 function create_rectTitle(data_link,continent_onclick,original_x_befor_click,original_y_befor_click,original_width_befor_click,original_height_befor_click,color_on_click){
	svg.append("rect")
    	.attr("x",0)
    	.attr("y",0)
    	.attr("width",width)
    	.attr("height",50)
    	.attr("opacity",0)
    	.attr("id","recttitle1")
    	.attr("fill","transparent")
    	.attr("background-color","transparent")
      .on("mouseover",  function(d){div.transition()		
                  .duration(500)		
                  .style("opacity", .8)
              		.style("background","white");              
              div.html("return to the first treemap")	
                  .style("left", (d3.event.pageX) + "px")		
                  .style("top", (d3.event.pageY - 28) + "px");}	)					
      .on("mouseout", function(){div.style("opacity", 0);})
      .on("click",function(d){
          
      	  divtitle.html("Demography of refugees in the world"); 
         d3.selectAll("path").remove();
         d3.selectAll("circle").remove();
	 d3.select("#my_dataviz2Ev").remove();
      
          d3.select("#recttitle1").attr("opacity",0)
          
          d3.selectAll("text").remove();
   				d3.selectAll("titles").remove();
    			d3.selectAll("vals").remove();
          
    	    
          d3.selectAll("rect")
            .transition()		
            .duration(1000)
            .attr('x', original_x_befor_click)
            .attr('y', original_y_befor_click )
            .attr('width', original_width_befor_click)
            .attr('height', original_height_befor_click)
          	.attr("opacity",0);
         setTimeout(function(){draw_all(data_link,"Grand_Total",true)},900);
        })
}


function draw_by_gender(data_link,countryName,dataofcountry,keyofcountry,color_on_click,original_x_befor_click,original_y_befor_click,original_width_befor_click,original_height_befor_click,data_csv,countryKey){
   
  var Female_0_17=0;var Female_18_59=0;var Female_60_plus=0;var Female_Total=0;var Female_unknown_age=0;
 var male_0_17=0;var male_18_59=0;var male_60_plus=0;var male_Total=0;var male_unknown_age=0;
 	var nestedJSONdataofcountry = '{"name":"'+dataofcountry.key+'","children":[{"name":"Female","children":[';
   dataofcountry.values.forEach(function(d){
     d.values.forEach(function(e){
       Female_0_17 += parseInt(e.Female_0_17);
       Female_18_59 += parseInt(e.Female_18_59);
       Female_60_plus += parseInt(e.Female_60_plus);
       Female_unknown_age += parseInt(e.Female_unknown_age);
       male_0_17 += parseInt(e.Male_0_17);
       male_18_59 += parseInt(e.Male_18_59);
       male_60_plus += parseInt(e.Male_60_plus);
       male_unknown_age += parseInt(e.Male_unknown_age);
     })
   })
   
   nestedJSONdataofcountry +='{"name":"Female_0_17","value":"'+Female_0_17+'"},'+
 '{"name":"Female_18_59","value":"'+Female_18_59+'"},'+
'{"name":"Female_60_plus","value":"'+Female_60_plus+'"},'+
 '{"name":"Female_unknown_age","value":"'+Female_unknown_age+'"}]'+
 ',"value":"'+Female_Total+'"},{"name":"male","children":['+
 '{"name":"male_0_17","value":"'+male_0_17+'"},'+
 '{"name":"male_18_59","value":"'+male_18_59+'"},'+
'{"name":"male_60_plus","value":"'+male_60_plus+'"},'+
 '{"name":"male_unknown_age","value":"'+male_unknown_age+'"}]'+
 ',"value":"'+male_Total+'"}]}'
   var listattrubute = ["Female_0_17","Female_18_59","Female_60_plus","Female_unknown_age","male_0_17","male_18_59","male_60_plus","male_unknown_age"];
    
 var stractueddataofcountry = JSON.parse(nestedJSONdataofcountry); 
  //console.log(stractueddataofcountry);
   var root1 = d3.hierarchy(stractueddataofcountry).sum(function(d){return d.value;});
d3.treemap()
    .size([width, height])
    .paddingTop(28)
    .paddingRight(7)
    .paddingInner(3)      // Padding between each rectangle
    //.paddingOuter(6)
    //.padding(20)
    (root1)

  // prepare a color scale
  var colorGender = d3.scaleOrdinal()
    .domain(["male", "Female"])
    .range(["#1f77b4", "#ff7f0e"]);
	//console.log(root1.leaves())
  // use this information to add rectangles:
   
   
   d3.selectAll("rect").remove();   
   
   
   svg.append("rect")
      .attr("id", keyofcountry)
      .attr('x', 0)
      .attr('y', 30)
      .attr('width', width)
      .attr('height', height-20)
      .style("stroke", "black")
      .attr("opacity",1)
      .attr("fill",color_on_click);
   
   var rects = svg.selectAll("rect")
    .data(root1.leaves())
    .enter()  
    .append("rect")
      .attr("id",function(d){return d.data.name;})
      .attr('x', function (d) {return d.x0+5; })
      .attr('y', function (d) { return d.y0; })
      .attr('width', 0)
      .attr('height', 0)
      .style("fill", function(d){
    			return colorGender(d.parent.data.name);} )
      .style("opacity", 1)
      .style("stroke", "white")
      .on("mouseover", function(d){	
     		div.transition()		
                  .duration(500)		
                  .style("opacity", .8)
              		.style("background","white");              
              div.html("country: "+countryName+"</br>category : "+d.data.name+"<br/>value : "+d.value+"</br>click for more details")	
                  .style("left", (d3.event.pageX) + "px")		
                  .style("top", ( d3.event.pageY - 28) + "px");
           })					
      .on("mouseout", function(){div.style("opacity", 0);})
      .on("click",function(d){
	    
     	display_courbe(data_csv,countryKey,listattrubute);
      });
   
	rects.transition()  // Gives the fly out from the center effect
		.delay(function (d, i){
			return i * 10;  // Gives a slight delay with 100 ms spacing
		})
		.duration(800)         
		.attr('width', function (d) {return d.x1 - d.x0; })
		.attr('height', function (d) {return d.y1 - d.y0; })
	  
   var rectexcept =svg.append("rect")
      .attr("id",root1.leaves()[0].data.name)
      .attr('x', root1.leaves()[0].x0+5)
      .attr('y', root1.leaves()[0].y0)
      .attr('width', 0)
      .attr('height', 0)
      .style("fill", function(d){
    			return colorGender(root1.leaves()[0].parent.data.name);} )
      .style("opacity", 1)
      .style("stroke", "white")
      .on("mouseover",function(d){	
     					div.transition()		
                  .duration(500)		
                  .style("opacity", .8)
              		.style("background","white");              
              div.html("Country : "+countryName+"</br>category : "+root1.leaves()[0].data.name+"<br/>value : "+root1.leaves()[0].value+"</br>click for more details")	
                  .style("left", (d3.event.pageX) + "px")		
                  .style("top", ( d3.event.pageY - 28) + "px");
   			})					
      .on("mouseout", function(){div.style("opacity", 0);})
      .on("click",function(d){ 
         display_courbe(data_csv,countryKey,listattrubute);
      });

	rectexcept.transition()  // Gives the fly out from the center effect
		.delay(function (d, i){
			return i * 10;  // Gives a slight delay with 100 ms spacing
		})
		.duration(800)         
		.attr('width', root1.leaves()[0].x1 - root1.leaves()[0].x0)
		.attr('height', root1.leaves()[0].y1 - root1.leaves()[0].y0)
   
create_rectTitle(data_link,"#"+keyofcountry,original_x_befor_click,original_y_befor_click,original_width_befor_click,original_height_befor_click);
   d3.selectAll("text").remove();
   d3.selectAll("titles").remove();
    d3.selectAll("vals").remove();
  // and to add the text labels
  svg
    .selectAll("text")
    .data(root1.leaves().filter(function(d){return d.value>=1;}))
    .enter()
    .append("text")
      .attr("x", function(d){return d.x0+10})    // +10 to adjust position (more right)
      .attr("y", function(d){ return d.y0+15})    // +20 to adjust position (lower)
      .text(function(d){ return d.data.name })
      .attr("font-size", "15px")
      .attr("fill", "white")

  // and to add the text labels
  svg
    .selectAll("vals")
    .data(root1.leaves().filter(function(d){return d.value>=1;}))
    .enter()
    .append("text")
      .attr("x", function(d){ return d.x0+10})    // +10 to adjust position (more right)
      .attr("y", function(d){ return d.y0+30})    // +20 to adjust position (lower)
      .text(function(d){ return d.value })
      .attr("font-size", "15px")
      .attr("fill", "white")

  // Add title for the 3 groups
  svg
    .selectAll("titles")
    .data(root1.descendants().filter(function(d){return d.depth==1})
              .filter(function(d){return d.value>0;}))
    .enter()
    .append("text")
      .attr("x", function(d){ return d.x0})
      .attr("y", function(d){ return d.y0+21})
      .text(function(d){ return d.data.name + ": "+d.value; })
      .attr("font-size", "20px")
      .attr("font-weight", "bold")
      .attr("fill",  function(d){return colorGender(d.data.name)} )
  }  
     
function display_courbe(data,country,listattrubute){   
     //console.log(data);
     //console.log(data);
	 d3.selectAll("path").remove();
         d3.selectAll("circle").remove();
	 d3.select("#my_dataviz2Ev").remove();
	 
	 var div2 = d3.select("body").append("div")	
       .attr("class", "div2svg")	
       .attr("id","my_dataviz2Ev");
	   
	 var svg2 = d3.select("#my_dataviz2Ev")
		.append("svg")
		.attr("width", width + margin.left + margin.right)
		.attr("height", height + margin.top + margin.bottom) 
     
         var parseDate = d3.timeParse("%Y");    
     
     var x = d3.scaleTime()
    	.domain(d3.extent(data,function(d){return d.Year;})).nice()
	.range([margin.left, width-margin.left-margin.right-20])
			
	var maximumValue = 0;
	var filtred_data = data.filter(function(d){return d.Country_of_Resettlement_ISO == country;}); 
	
    
     
    var color= d3.scaleOrdinal()
    .domain(["Female_0_17","Female_18_59","Female_60_plus","Female_unknown_age","male_0_17","male_18_59","male_60_plus","male_unknown_age","Total_departures_persons","Total_submissons_persons"])
    .range(["#ffbb78","#ff7f0e","#ff7f0e","grey","#aec7e8","#1f77b4","#1f77b4" , "grey","red","red"]);   
   	     
     
      
  for(i of listattrubute ){   
        scatterplot(svg2,filtred_data,color(i),'Year',i,width,height,margin.left+30,10);        
      }

  function scatterplot(el,data,var_color,var_x,var_y, dim_width,dim_height,pos_x,pos_y){
        //console.log(data); 
  	var nested_data = d3.nest()      
          .key(function(d) {return d[var_x];})
          .rollup(function(d) {
            return d3.sum(d,function(v){
              return parseInt(v[var_y])});
          })
          .entries(data);
        
       if(maximumValue ==0){
      maximumValue = d3.max([maximumValue,d3.max(d3.extent(nested_data,function(d){return d.value;}))])
	 //console.log(maximumValue);
     }
     var y = d3.scaleLinear()
            .domain([0, maximumValue])
            .range([height-margin.top-margin.bottom,margin.top])
			
    //console.log(nested_data);
     var displayDate = d3.timeFormat("%Y");  
    
     
     var line = d3.line()
    	.curve(d3.curveMonotoneX)
      .x(function(d, i) { return x(parseDate(d.key.split(" ")[3]));})
      .y(function(d, i) { return  y(parseInt(d.value));})

	var g55 = el.append("g")
  		.attr("transform","translate("+pos_x+","+pos_y+")");
      
       g55.selectAll("path")
            .data([nested_data.sort((a,b) => parseInt(b.key.split(" ")[3]) - parseInt(a.key.split(" ")[3]))])
            .enter()
            .append("path")
            .style("fill","none")
     	    .style("stroke",var_color)
            .style("stroke-width",2)
     	    .attr("d", line)
            .on("mouseover",function(d){
              d3.selectAll("path").filter(function(e){
                return d==e;
              }).style("stroke", "red")
              	.style("stroke-width", 4);
            })
            .on("mouseout",function(d){
              d3.selectAll("path").filter(function(e){
                return d==e;
              }).style("stroke", var_color)
              	.style("stroke-width", 2);             	
            })
            .on("click",function(d){ console.log("ok");});      
            
           g55.selectAll("circle")
            .data(nested_data.sort((a,b) => parseInt(b.key.split(" ")[3]) - parseInt(a.key.split(" ")[3])))
            .enter()
            .append("circle")
            .attr("cx", function(d) { return x(parseDate(d.key.split(" ")[3])); })
            .attr("cy", function(d) { return y(parseInt(d.value)); })
            .attr("r",3)
            .attr("fill",var_color)
            .on("mouseover",function(d){         
              div.style("opacity", .8)
              	  .style("background","white");              
              div.html("year : "+d.key.split(" ")[3]+"<br/> value : "+d.value)	
                  .style("left", (d3.event.pageX) + "px")		
                  .style("top", ( d3.event.pageY - 28) + "px");                       				
            })
            .on("mouseout",function(d){             
                div.style("opacity",0);
             })
              .on("click",function(d){ console.log("ok");});
      
   		var xAxis = d3.axisBottom()
    				.scale(x);

		var yAxis = d3.axisLeft()
    				.scale(y);

          g55.append("g")
            .attr("class", "x axis")
            .attr("transform", "translate(0," +(dim_height-margin.top-margin.bottom)+ ")")
            .call(xAxis)
          
          g55.append("g")
            .attr("class", "y axis")
          	.attr("transform", "translate("+margin.left+",0 )")
            .call(yAxis)
	}

}
</script>
<script src="js/vendor/jquery-2.2.4.min.js"></script>
			<script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.12.9/umd/popper.min.js" integrity="sha384-ApNbgh9B+Y1QKtv3Rn7W3mgPxhU9K/ScQsAP7hUibX39j7fakFPskvXusvfa0b4Q" crossorigin="anonymous"></script>
			<script src="js/vendor/bootstrap.min.js"></script>			
			<script type="text/javascript" src="https://maps.googleapis.com/maps/api/js?key=AIzaSyBhOdIF3Y9382fqJYt5I_sswSrEw5eihAA"></script>
  			<script src="js/easing.min.js"></script>			
			<script src="js/hoverIntent.js"></script>
			<script src="js/superfish.min.js"></script>	
			<script src="js/jquery.ajaxchimp.min.js"></script>
			<script src="js/jquery.magnific-popup.min.js"></script>	
			<script src="js/jquery.sticky.js"></script>
			<script src="js/jquery.nice-select.min.js"></script>			
			<script src="js/parallax.min.js"></script>		
			<script src="js/mail-script.js"></script>	
			<script src="js/main.js"></script>
</body>
</html>
